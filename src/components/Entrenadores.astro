---
/*
  ü¶å Venados Atalaya ‚Äî Secci√≥n Entrenadores con Tabs (vanilla JS)
  - Sin onClick/estado de Astro (no reactivo)
  - Tabs con data-atributos y JS nativo
  - Observer con nombre √∫nico para evitar ‚ÄúIdentifier has already been declared‚Äù
*/

import { withBase } from "@/utils/withBase";

const entrenadores = [
  {
    id: "tecnico",
    nombre: "Profr. Jos√© Luis Hern√°ndez",
    cargo: "Director T√©cnico",
    especialidad: "T√°ctica y alto rendimiento",
    bio: "Con m√°s de 15 a√±os de experiencia dirigiendo academias y equipos semiprofesionales. Su enfoque integra disciplina t√°ctica, liderazgo emocional y lectura avanzada del juego.",
    img: "/img/directortecnico.webp",
    tags: ["T√°ctica", "Estrategia", "Liderazgo"],
  },
  {
    id: "fisico",
    nombre: "Entrenadora Karina Ram√≠rez",
    cargo: "Preparadora F√≠sica",
    especialidad: "Fuerza, coordinaci√≥n y resistencia",
    bio: "Especialista en acondicionamiento deportivo infantil y juvenil. Combina entrenamiento funcional con ejercicios correctivos y prevenci√≥n de lesiones.",
    img: "/img/preparadora.webp",
    tags: ["F√≠sico", "Resistencia", "Prevenci√≥n"],
  },
  {
    id: "porteros",
    nombre: "Profr. Miguel Torres",
    cargo: "Formador de Porteros",
    especialidad: "Reflejos, t√©cnica y dominio del √°rea",
    bio: "Ex arquero profesional con amplia experiencia en formaci√≥n t√©cnica y t√°ctica. Fomenta agilidad, concentraci√≥n y liderazgo bajo presi√≥n.",
    img: "/img/entrenadorporteros.webp",
    tags: ["Porteros", "Reflejos", "Liderazgo"],
  },
  {
    id: "mental",
    nombre: "Coach Lucia Morales",
    cargo: "Preparadora Mental",
    especialidad: "Concentraci√≥n, confianza y resiliencia deportiva",
    bio: "Psic√≥loga deportivo especializada en control emocional y mentalidad competitiva. Potencia la autoconfianza y la motivaci√≥n en los atletas.",
    img: "/img/couchmental.webp",
    tags: ["Mental", "Motivaci√≥n", "Confianza"],
  },
];
const defaultActiveId = entrenadores[0].id;
---

<section id="entrenadores" class="relative py-24 bg-[var(--color-dark)] text-[var(--color-light)] overflow-hidden" aria-labelledby="titulo-entrenadores">
  <!-- üå´Ô∏è Degradado superior -->
  <div class="absolute top-0 inset-x-0 h-24 bg-gradient-to-b from-black/50 to-transparent"></div>

  <!-- üè∑Ô∏è T√çTULO -->
  <header class="text-center mb-16 relative z-10">
    <h2 id="titulo-entrenadores" class="text-4xl md:text-5xl font-extrabold tracking-wide mb-4 leading-tight">
      NUESTROS <span class="text-[var(--color-secondary)]">ENTRENADORES</span>
    </h2>
    <div class="flex justify-center mt-4 mb-8">
      <div class="w-32 h-[3px] bg-[var(--color-accent)] rounded-full shadow-[0_0_15px_rgba(255,215,0,0.6)]"></div>
    </div>
    <p class="text-light/80 max-w-2xl mx-auto text-lg font-light">
      Cuerpo t√©cnico de √©lite enfocado en desarrollar todas las dimensiones del futbolista: t√©cnica, f√≠sica y mental.
    </p>
  </header>

  <!-- üßë‚Äçüè´ TABS CON IMAGEN -->
  <div class="flex justify-center gap-6 flex-wrap max-w-5xl mx-auto mb-12 px-4" role="tablist" aria-label="Entrenadores">
    {entrenadores.map((e) => (
      <button
        data-tab={e.id}
        role="tab"
        aria-selected={e.id === defaultActiveId ? "true" : "false"}
        aria-controls={`panel-${e.id}`}
        tabindex={e.id === defaultActiveId ? "0" : "-1"}
        class={`relative w-28 h-28 rounded-full overflow-hidden border-2 transition-all duration-300 cursor-pointer focus:outline-none
          ${e.id === defaultActiveId
            ? "border-[var(--color-accent)] scale-105 shadow-[0_0_20px_rgba(255,215,0,0.5)]"
            : "border-white/20 hover:scale-105 hover:border-[var(--color-secondary)]"}`}
      >
        <img src={e.img} alt={e.nombre} class="absolute inset-0 w-full h-full object-cover brightness-90" loading="lazy" />
        <div class={`absolute inset-0 flex items-end justify-center pb-2 text-xs font-semibold bg-gradient-to-t from-black/70 via-black/20 to-transparent ${
          e.id === defaultActiveId ? "text-[var(--color-accent)]" : "text-white/70"
        }`}>
          {e.cargo.split(" ")[1]}
        </div>
      </button>
    ))}
  </div>

  <!-- üìò PANELES -->
  <div class="max-w-6xl mx-auto px-6 relative z-10">
    {entrenadores.map((e) => (
      <div
        id={`panel-${e.id}`}
        data-panel={e.id}
        role="tabpanel"
        aria-labelledby={e.id}
        class={`grid gap-10 md:grid-cols-2 items-center transition-all duration-700 ease-in-out transform ${
          e.id === defaultActiveId ? "opacity-100 translate-y-0" : "hidden opacity-0 translate-y-6"
        }`}
      >
        <!-- üñºÔ∏è Imagen -->
        <img
          src={e.img}
          alt={`Foto de ${e.nombre}`}
          class="w-full h-72 md:h-96 object-cover rounded-xl shadow-lg border border-white/10"
          loading="lazy"
          decoding="async"
        />

        <!-- üìÑ Detalles -->
        <div>
          <h3 class="text-3xl md:text-4xl font-extrabold text-[var(--color-accent)] mb-3">{e.nombre}</h3>
          <p class="text-sm font-medium text-light/80 mb-1">{e.cargo}</p>
          <p class="text-xs text-light/70 italic mb-4">{e.especialidad}</p>
          <p class="text-light/85 mb-6 leading-relaxed">{e.bio}</p>

          <!-- TAGS -->
          <div class="flex flex-wrap gap-2 mb-6">
            {e.tags.map((tag) => (
              <span class="text-xs px-3 py-1 bg-[var(--color-secondary)]/20 rounded-full text-[var(--color-accent)] border border-[var(--color-secondary)]/40">
                {tag}
              </span>
            ))}
          </div>

          <!-- CTA -->
          <a href={`#inscripcion?coach=${encodeURIComponent(e.nombre)}`} class="inline-block bg-[var(--color-accent)] text-[var(--color-dark)] font-semibold px-8 py-3 rounded-md shadow-md hover:scale-105 transition">
            Agendar prueba
          </a>
        </div>
      </div>
    ))}
  </div>

  <!-- ‚ú® JS vanilla: tabs + animaci√≥n de aparici√≥n (sin colisiones de nombres) -->
  <script is:inline>
    (() => {
      const root = document.getElementById("entrenadores");
      if (!root) return;

      const tabs = Array.from(root.querySelectorAll("[data-tab]"));
      const panels = Array.from(root.querySelectorAll("[data-panel]"));

      const setActive = (id) => {
        // Tabs
        tabs.forEach((btn) => {
          const active = btn.getAttribute("data-tab") === id;
          btn.setAttribute("aria-selected", active ? "true" : "false");
          btn.setAttribute("tabindex", active ? "0" : "-1");
          btn.classList.toggle("scale-105", active);
          btn.classList.toggle("shadow-[0_0_20px_rgba(255,215,0,0.5)]", active);
          btn.classList.toggle("border-[var(--color-accent)]", active);
          btn.classList.toggle("border-white/20", !active);

          const label = btn.querySelector("div");
          if (label) {
            label.classList.toggle("text-[var(--color-accent)]", active);
            label.classList.toggle("text-white/70", !active);
          }
        });

        // Panels
        panels.forEach((panel) => {
          const match = panel.getAttribute("data-panel") === id;
          if (match) {
            panel.classList.remove("hidden", "opacity-0", "translate-y-6");
            panel.classList.add("opacity-100", "translate-y-0");
          } else {
            panel.classList.add("opacity-0", "translate-y-6");
            // espera transici√≥n, luego oculta para que no ocupe espacio
            setTimeout(() => panel.classList.add("hidden"), 250);
          }
        });
      };

      // Click
      tabs.forEach((btn) => {
        btn.addEventListener("click", () => setActive(btn.getAttribute("data-tab")));
        // Accesibilidad por teclado (‚Üê ‚Üí)
        btn.addEventListener("keydown", (e) => {
          const i = tabs.indexOf(btn);
          if (e.key === "ArrowRight") {
            e.preventDefault();
            const next = tabs[(i + 1) % tabs.length];
            next.focus(); setActive(next.getAttribute("data-tab"));
          } else if (e.key === "ArrowLeft") {
            e.preventDefault();
            const prev = tabs[(i - 1 + tabs.length) % tabs.length];
            prev.focus(); setActive(prev.getAttribute("data-tab"));
          }
        });
      });

      // Animaci√≥n de entrada (observer con nombre √∫nico para evitar colisiones)
      const trainersObserver = new IntersectionObserver(
        (entries) => {
          for (const entry of entries) {
            if (entry.isIntersecting) {
              entry.target.classList.add("opacity-100", "translate-y-0");
              trainersObserver.unobserve(entry.target);
            }
          }
        },
        { threshold: 0.2 }
      );

      root.querySelectorAll(".grid").forEach((el) => {
        el.classList.add("opacity-0", "translate-y-8", "transition-all", "duration-700", "ease-out");
        trainersObserver.observe(el);
      });
    })();
  </script>
</section>
